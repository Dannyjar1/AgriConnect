<!-- AgriConnect Productos - Página con SharedHeaderComponent -->
<div class="min-h-screen bg-gradient-agri font-noto-sans">
  
  <!-- Shared Header Component -->
  <app-shared-header currentPage="productos"></app-shared-header>

  <!-- Main Content Area -->
  <main class="max-w-7xl mx-auto px-4 lg:px-6 py-8">
    
    <!-- Page Title Section with Decorative Background -->
    <section class="py-12 text-center relative overflow-hidden">
      <!-- Decorative background pattern for the hero section -->
      <div class="absolute inset-0 opacity-5">
        <img [src]="multifruitImage()" 
             alt="Decorative fruits pattern"
             class="w-full h-full object-cover object-center scale-110 transform rotate-3"
             loading="lazy">
      </div>
      
      <div class="max-w-4xl mx-auto relative z-10">
        <h1 class="text-4xl lg:text-6xl font-black text-gray-900 mb-6 font-epilogue leading-tight">
          <span class="text-gradient-agri">Productos</span> Frescos de Ecuador
        </h1>
        <p class="text-xl lg:text-2xl text-gray-600 mb-12 max-w-3xl mx-auto leading-relaxed">
          Descubre la variedad más amplia de productos agrícolas ecuatorianos, directo desde el campo hasta tu mesa
        </p>
        
        <!-- Floating fruit elements for visual appeal -->
        <div class="absolute -top-4 -left-8 w-16 h-16 opacity-20 animate-bounce animation-delay-1000">
          <img [src]="multifruitImage()" 
               alt="Fruit decoration"
               class="w-full h-full object-cover rounded-full"
               loading="lazy">
        </div>
        <div class="absolute -top-8 -right-12 w-20 h-20 opacity-15 animate-bounce animation-delay-2000">
          <img [src]="multifruitImage()" 
               alt="Fruit decoration"
               class="w-full h-full object-cover rounded-full transform rotate-45"
               loading="lazy">
        </div>
      </div>
    </section>

    <!-- Categories Grid -->
    <section class="py-8">
      @if (isLoading()) {
        <div class="text-center py-16">
          <div class="w-12 h-12 border-4 border-gray-200 border-t-agri-green-600 rounded-full animate-spin mx-auto mb-4"></div>
          <p class="text-xl text-gray-600">Cargando productos frescos...</p>
        </div>
      } @else {
        @for (categoryData of productsByCategory(); track categoryData.category) {
          <div class="mb-16 relative">
            <!-- Category Title with Enhanced Design -->
            <div class="text-center mb-12 relative">
              <!-- Background decoration for fruit categories -->
              @if (isFruitCategory()(categoryData.category)) {
                <div class="absolute -inset-8 opacity-5 pointer-events-none">
                  <img [src]="multifruitImage()" 
                       alt="Category decoration"
                       class="w-full h-32 object-cover object-center rounded-lg transform scale-110"
                       loading="lazy">
                </div>
              }
              
              <div class="relative z-10">
                <h2 class="text-3xl font-bold text-gray-900 mb-4 font-epilogue">{{ categoryData.category }}</h2>
                <div class="w-24 h-1 bg-agri-green-500 mx-auto rounded-full"></div>
                
                <!-- Special indicator for fruit categories -->
                @if (isFruitCategory()(categoryData.category)) {
                  <div class="mt-3 flex justify-center items-center space-x-2">
                    <div class="w-2 h-2 bg-orange-400 rounded-full animate-pulse"></div>
                    <span class="text-sm text-gray-600 font-medium">Frutas Frescas Ecuatorianas</span>
                    <div class="w-2 h-2 bg-yellow-400 rounded-full animate-pulse animation-delay-500"></div>
                  </div>
                }
              </div>
            </div>
            
            <!-- Products Grid with Enhanced Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
              @for (product of categoryData.products; track product.id) {
                <div class="card card-hover hover-lift group cursor-pointer relative overflow-hidden" 
                     (click)="navigateToProduct(product.id)">
                  
                  <!-- Subtle background decoration for fruit products -->
                  @if (isFruitCategory()(categoryData.category)) {
                    <div class="absolute inset-0 opacity-3 pointer-events-none">
                      <img [src]="multifruitImage()" 
                           alt="Product decoration"
                           class="w-full h-full object-cover transform scale-150 rotate-12"
                           loading="lazy">
                    </div>
                  }
                  
                  <!-- Product Image Container -->
                  <div class="relative aspect-w-4 aspect-h-3 overflow-hidden z-10">
                    <!-- Integración carrito unificado + fallback de imagen -->
                    <img 
                      [src]="product.images && product.images.length > 0 ? product.images[0] : 'assets/images/multifrutas.webp'" 
                      [alt]="product.name" 
                      class="w-full h-40 object-cover rounded-lg product-img"
                      (error)="onImageError($event)"
                      loading="lazy">
                    
                    <!-- Enhanced overlay with gradient -->
                    <div class="absolute inset-0 bg-gradient-to-t from-black/10 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    
                    <!-- Certifications Badge -->
                    <div class="absolute top-4 left-4">
                      @if (product.certifications.length > 0) {
                        <span class="bg-agri-green-600 text-white px-3 py-1 rounded-lg text-xs font-semibold uppercase tracking-wide shadow-lg">
                          {{ product.certifications[0] }}
                        </span>
                      }
                    </div>
                    
                    <!-- Province Badge -->
                    <div class="absolute top-4 right-4">
                      <span class="bg-white bg-opacity-95 text-gray-700 px-2 py-1 rounded text-xs font-medium shadow-md">
                        {{ product.province }}
                      </span>
                    </div>
                    
                    <!-- Special fruit indicator -->
                    @if (isFruitCategory()(categoryData.category)) {
                      <div class="absolute bottom-4 left-4">
                        <div class="flex items-center space-x-1 bg-yellow-400/90 text-yellow-900 px-2 py-1 rounded-full text-xs font-medium">
                          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                          </svg>
                          <span>Premium</span>
                        </div>
                      </div>
                    }
                  </div>
                  
                  <!-- Product Information -->
                  <div class="p-6 relative z-10">
                    <h3 class="text-xl font-bold text-gray-900 mb-2 font-epilogue leading-tight group-hover:text-agri-green-700 transition-colors">
                      {{ product.name }}
                    </h3>
                    <p class="text-gray-600 mb-4 line-clamp-2">{{ product.description }}</p>
                    
                    <!-- Category and Availability -->
                    <div class="flex justify-between items-center mb-6">
                      <span class="bg-gray-100 text-gray-600 px-3 py-1 rounded-lg text-sm font-medium">
                        {{ product.category }}
                      </span>
                      <span class="text-gray-500 text-sm flex items-center space-x-1">
                        <span class="w-2 h-2 bg-green-500 rounded-full stock-indicator"></span>
                        <span>{{ product.availability }} disponible</span>
                      </span>
                    </div>
                    
                    <!-- Price and Add to Cart -->
                    <div class="flex justify-between items-center">
                      <div>
                        <span class="text-2xl font-bold text-agri-green-600 font-epilogue">
                          ${{ product.price.perUnit.toFixed(2) }}
                        </span>
                        <span class="text-gray-500 text-sm ml-1">por {{ product.price.unit }}</span>
                      </div>
                      <!-- Conectar "Agregar" buttons al CartService.add(product) -->
                      <button 
                        (click)="addToCart(product); $event.stopPropagation()"
                        class="bg-agri-green-600 hover:bg-agri-green-700 text-white font-semibold px-4 py-2 rounded-lg transition-all duration-300 hover:-translate-y-0.5 flex items-center space-x-2 group-hover:shadow-lg focus:ring-2 focus:ring-agri-green-500 focus:ring-offset-2"
                        [attr.aria-label]="'Agregar ' + product.name + ' al carrito'">
                        <span class="material-icons text-lg">add_shopping_cart</span>
                        <span class="hidden sm:inline">Agregar</span>
                      </button>
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        }
      }
    </section>
    
    <!-- Decorative Footer Section -->
    <section class="py-12 relative overflow-hidden">
      <div class="absolute inset-0 opacity-5">
        <img [src]="multifruitImage()" 
             alt="Footer decoration"
             class="w-full h-full object-cover transform scale-125 -rotate-6"
             loading="lazy">
      </div>
      <div class="text-center relative z-10">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">
          ¡Descubre más productos ecuatorianos!
        </h3>
        <p class="text-gray-600 max-w-2xl mx-auto">
          Cada producto cuenta una historia única de nuestros productores locales. 
          Apoya la agricultura ecuatoriana y disfruta de la frescura auténtica.
        </p>
      </div>
    </section>
  </main>
</div>