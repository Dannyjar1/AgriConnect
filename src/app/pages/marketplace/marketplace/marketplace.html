<!-- AgriConnect Marketplace - Dise√±o Moderno con TailwindCSS -->
<div class="min-h-screen bg-gradient-agri font-noto-sans">
  
  <!-- Shared Header Component -->
  <app-shared-header currentPage="marketplace"></app-shared-header>

  <!-- Main Content Area -->
  <main class="max-w-7xl mx-auto px-4 lg:px-6">
    
    <!-- Hero Search Section with Decorative Background -->
    <section class="py-16 lg:py-24 text-center relative overflow-hidden">
      <!-- Decorative background pattern for the hero section -->
      <div class="absolute inset-0 opacity-5">
        <img [src]="multifruitImage()" 
             alt="Decorative fruits pattern"
             class="w-full h-full object-cover object-center scale-110 transform rotate-3"
             loading="lazy">
      </div>
      
      <div class="max-w-4xl mx-auto relative z-10">
        <h1 class="text-4xl lg:text-6xl font-black text-gray-900 mb-6 font-epilogue leading-tight">
          <span class="text-gradient-agri">Encuentra Productos</span> Frescos Locales
        </h1>
        <p class="text-xl lg:text-2xl text-gray-600 mb-12 max-w-3xl mx-auto leading-relaxed">
          Con√©ctate directamente con productores locales y recibe los productos m√°s frescos en tu puerta
        </p>
        
        <!-- Floating fruit elements for visual appeal -->
        <div class="absolute -top-4 -left-8 w-16 h-16 opacity-20 animate-bounce animation-delay-1000">
          <img [src]="multifruitImage()" 
               alt="Fruit decoration"
               class="w-full h-full object-cover rounded-full"
               loading="lazy">
        </div>
        <div class="absolute -top-8 -right-12 w-20 h-20 opacity-15 animate-bounce animation-delay-2000">
          <img [src]="multifruitImage()" 
               alt="Fruit decoration"
               class="w-full h-full object-cover rounded-full transform rotate-45"
               loading="lazy">
        </div>
        
        <!-- Primary Search Bar -->
        <div class="mb-8">
          <form [formGroup]="searchForm" class="max-w-2xl mx-auto">
            <div class="relative">
              <span class="absolute left-6 top-1/2 transform -translate-y-1/2 text-gray-400 material-icons text-2xl">search</span>
              <input 
                type="text" 
                formControlName="searchTerm"
                placeholder="Busca frutas frescas, vegetales, l√°cteos..."
                class="w-full pl-16 pr-6 py-6 text-lg border-2 border-gray-200 rounded-2xl focus:ring-4 focus:ring-agri-green-100 focus:border-agri-green-500 transition-all duration-300 bg-white shadow-lg"
                aria-label="Buscar productos">
            </div>
          </form>
        </div>
        
        <!-- Custom Requirements Field -->
        <div class="max-w-2xl mx-auto">
          <form [formGroup]="searchForm" (ngSubmit)="onSubmitNeeds()">
            <div class="relative">
              <span class="absolute left-6 top-1/2 transform -translate-y-1/2 text-gray-400 material-icons text-xl">edit_note</span>
              <input 
                type="text" 
                formControlName="customNeed"
                placeholder="Necesito: 5kg tomates org√°nicos, vegetales sin pesticidas..."
                class="w-full pl-16 pr-20 py-4 border border-gray-300 rounded-xl focus:ring-4 focus:ring-agri-green-100 focus:border-agri-green-500 transition-all bg-white italic placeholder-gray-400"
                aria-label="Describe tus necesidades espec√≠ficas">
              <button type="submit" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-agri-green-600 hover:bg-agri-green-700 text-white w-12 h-12 rounded-lg transition-all hover:scale-105">
                <span class="material-icons">send</span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- Categories Quick Filter -->
    <section class="py-8">
      <div class="max-w-4xl mx-auto text-center">
        <div class="flex flex-wrap justify-center gap-3">
          @for (category of categories(); track category) {
            <button 
              type="button"
              (click)="onCategorySelect(category)"
              [class]="selectedCategory() === category ? 
                'bg-agri-green-600 text-white border-agri-green-600' : 
                'bg-white text-gray-600 border-gray-300 hover:border-agri-green-500 hover:text-agri-green-600 hover:bg-agri-green-50'"
              class="px-6 py-3 rounded-full border font-medium transition-all duration-200 font-epilogue">
              {{ category }}
            </button>
          }
        </div>
      </div>
    </section>

    <!-- Ecuadorian Products by Category Section - ELIMINADA -->
    <!-- 
    Secci√≥n comentada: "Productos Ecuatorianos por Categor√≠a"
    Inclu√≠a productos como Banano, Cacao Nacional, Br√≥coli Andino, Quinoa Org√°nica y Camar√≥n Ecuatoriano
    -->

    <!-- Original Products Grid Section -->
    <section class="py-12">
      <div class="max-w-6xl mx-auto">
        <div class="text-center mb-16">
          <h2 class="text-4xl font-bold text-gray-900 mb-4 font-epilogue">Productos Sugeridos Cerca de Ti</h2>
          <p class="text-xl text-gray-600 max-w-2xl mx-auto">
            Productos frescos de productores locales en tu zona
          </p>
        </div>
        
        @if (isLoading()) {
          <div class="text-center py-16">
            <div class="w-12 h-12 border-4 border-gray-200 border-t-agri-green-600 rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-xl text-gray-600">Buscando productos frescos para ti...</p>
          </div>
        }
        
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
          @if (filteredProducts$ | async; as products) {
            @if (products.length > 0) {
              @for (product of products; track product.id) {
                <div class="card card-hover hover-lift group">
                  <div class="relative aspect-w-4 aspect-h-3 overflow-hidden">
                    <!-- Integraci√≥n carrito unificado + fallback de imagen -->
                    <img 
                      [src]="product.images && product.images.length > 0 ? product.images[0] : 'assets/images/multifrutas.webp'" 
                      [alt]="product.name" 
                      (error)="onImageError($event)"
                      class="w-full h-40 object-cover rounded-lg product-img">
                    <div class="absolute top-4 left-4">
                      @if (product.certifications.length > 0) {
                        <span class="bg-agri-green-600 text-white px-3 py-1 rounded-lg text-xs font-semibold uppercase tracking-wide">
                          {{ product.certifications[0] }}
                        </span>
                      }
                    </div>
                  </div>
                  
                  <div class="p-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-2 font-epilogue leading-tight">{{ product.name }}</h3>
                    <p class="text-gray-600 mb-4 line-clamp-2">{{ product.description }}</p>
                    
                    <div class="flex justify-between items-center mb-6">
                      <span class="bg-gray-100 text-gray-600 px-3 py-1 rounded-lg text-sm font-medium">{{ product.category }}</span>
                      <span class="text-gray-500 text-sm">{{ product.availability }} disponibles</span>
                    </div>
                    
                    <div class="flex justify-between items-center">
                      <div>
                        <span class="text-2xl font-bold text-agri-green-600 font-epilogue">${{ product.price.perUnit.toFixed(2) }}</span>
                        <span class="text-gray-500 text-sm ml-1">por {{ product.price.unit }}</span>
                      </div>
                      <!-- Conectar "Agregar" buttons al CartService.add(product) -->
                      <button 
                        (click)="addToCart(product)"
                        class="bg-agri-green-600 hover:bg-agri-green-700 text-white font-semibold px-4 py-2 rounded-lg transition-all hover:-translate-y-0.5 flex items-center space-x-2 group-hover:shadow-lg"
                        [attr.aria-label]="'Agregar ' + product.name + ' al carrito'">
                        <span class="material-icons text-lg">add_shopping_cart</span>
                        <span>Agregar</span>
                      </button>
                    </div>
                  </div>
                </div>
              }
            } @else {
              <div class="col-span-full text-center py-20">
                <div class="text-8xl mb-8 opacity-60">üå±</div>
                <h3 class="text-2xl font-bold text-gray-700 mb-4 font-epilogue">No se encontraron productos</h3>
                <p class="text-gray-600 mb-8 max-w-md mx-auto">
                  Prueba ajustando tus criterios de b√∫squeda o navega por nuestras categor√≠as sugeridas
                </p>
                <button (click)="onClearFilters()" class="btn-primary">
                  Ver Todos los Productos
                </button>
              </div>
            }
          }
        </div>
      </div>
    </section>
    
    <!-- Decorative Footer Section -->
    <section class="py-12 relative overflow-hidden">
      <div class="absolute inset-0 opacity-5">
        <img [src]="multifruitImage()" 
             alt="Footer decoration"
             class="w-full h-full object-cover transform scale-125 -rotate-6"
             loading="lazy">
      </div>
      <div class="text-center relative z-10">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">
          ¬°Encuentra los mejores productos locales!
        </h3>
        <p class="text-gray-600 max-w-2xl mx-auto">
          Conecta directamente con productores de tu regi√≥n y accede a productos frescos y de calidad. 
          Apoya la econom√≠a local y disfruta de la frescura aut√©ntica.
        </p>
      </div>
    </section>
    
  </main>
</div>

<!-- Enhanced Custom Styles -->
<style>
.logo-image {
  background-image: url('/assets/images/agriconnect-logo.svg');
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  background-color: transparent;
}

.text-gradient-agri {
  background: linear-gradient(135deg, var(--color-agri-green-600), var(--color-agri-green-400));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.card-hover {
  transition: all 0.3s ease;
  backdrop-filter: blur(1px);
}

.card-hover:hover {
  transform: translateY(-4px);
  box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
}

.hover-lift {
  transition: transform 0.3s ease;
}

.hover-lift:hover {
  transform: translateY(-2px);
}

.product-img {
  transition: transform 0.3s ease;
}

.group:hover .product-img {
  transform: scale(1.05);
}

.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Enhanced animations */
@keyframes float {
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-10px);
  }
}

.animation-delay-1000 {
  animation-delay: 1s;
}

.animation-delay-2000 {
  animation-delay: 2s;
}

.animation-delay-500 {
  animation-delay: 0.5s;
}

/* Fruit decoration animations */
.animate-bounce {
  animation: bounce 2s infinite;
}

@keyframes bounce {
  0%, 20%, 53%, 80%, 100% {
    animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
    transform: translate3d(0, 0, 0);
  }
  40%, 43% {
    animation-timing-function: cubic-bezier(0.755, 0.05, 0.855, 0.06);
    transform: translate3d(0, -30px, 0);
  }
  70% {
    animation-timing-function: cubic-bezier(0.755, 0.05, 0.855, 0.06);
    transform: translate3d(0, -15px, 0);
  }
  90% {
    transform: translate3d(0, -4px, 0);
  }
}

/* Stock indicator pulse */
.stock-indicator::before {
  animation: pulse-ring 2s infinite;
}

@keyframes pulse-ring {
  0% {
    transform: scale(0.33);
  }
  80%, 100% {
    opacity: 0;
  }
}

/* Hover effects for category sections */
@media (min-width: 768px) {
  .category-section:hover .multifruit-bg {
    opacity: 0.08;
    transform: scale(1.05);
  }
}

/* Improved focus states for accessibility */
button:focus-visible,
.card:focus-visible {
  outline: 2px solid var(--color-agri-green-500);
  outline-offset: 2px;
}

/* Responsive enhancements */
@media (max-width: 640px) {
  .absolute.-top-4.-left-8,
  .absolute.-top-8.-right-12 {
    display: none;
  }
  
  .card .absolute.inset-0.opacity-3 {
    opacity: 0.02;
  }
}

/* Loading state improvements */
.animate-spin {
  animation: spin 1s linear infinite;
}

/* Enhanced premium badge */
.bg-yellow-400\/90 {
  background-color: rgb(251 191 36 / 0.9);
}

/* Smooth scrolling */
html {
  scroll-behavior: smooth;
}
</style>