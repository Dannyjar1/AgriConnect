<!-- Configuración de Algoritmos - Admin Panel -->
<div class="p-8 max-w-7xl mx-auto bg-slate-50 min-h-screen">

  <!-- Header -->
  <div class="mb-8">
    <div class="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-8 rounded-xl shadow-md">
      <h1 class="text-3xl font-bold mb-2 font-epilogue">Configuración de Algoritmos</h1>
      <p class="text-lg opacity-90 font-noto-sans">Ajusta los parámetros de los algoritmos de la plataforma</p>
    </div>
  </div>

  <!-- Category Filter -->
  <div class="bg-white p-6 rounded-xl shadow-sm mb-8">
    <div class="flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between">
      <h2 class="text-xl font-bold text-gray-900 font-epilogue">Configuraciones del Sistema</h2>

      <div class="flex flex-wrap gap-2">
        @for (category of categories; track category.value) {
        <button (click)="changeCategory(category.value)" [class]="'px-4 py-2 rounded-lg font-medium transition-all duration-200 font-noto-sans flex items-center gap-2 ' + 
                     (selectedCategory() === category.value 
                       ? 'bg-purple-600 text-white shadow-md' 
                       : 'bg-gray-100 text-gray-700 hover:bg-gray-200')">
          @if (category.value !== 'all') {
          <i [class]="getCategoryIcon(category.value)"></i>
          }
          {{ category.label }}
        </button>
        }
      </div>
    </div>
  </div>

  @if (isLoading()) {
  <!-- Loading State -->
  <div class="bg-white rounded-xl shadow-sm p-12">
    <div class="text-center">
      <div class="inline-flex items-center gap-3 text-gray-500">
        <svg class="animate-spin h-8 w-8" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
          </path>
        </svg>
        <span class="text-lg font-noto-sans">Cargando configuraciones...</span>
      </div>
    </div>
  </div>
  } @else {
  <!-- Configuration Form -->
  <form [formGroup]="configForm" (ngSubmit)="saveSettings()">

    <!-- Settings Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      @for (setting of filteredSettings; track setting.id) {
      <div class="bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition-shadow duration-200">

        <!-- Setting Header -->
        <div class="flex items-start gap-4 mb-4">
          <div [class]="'w-10 h-10 bg-gradient-to-br ' + 
                           (getCategoryColor(setting.category) === 'blue' ? 'from-blue-500 to-blue-600' :
                            getCategoryColor(setting.category) === 'green' ? 'from-green-500 to-green-600' :
                            getCategoryColor(setting.category) === 'purple' ? 'from-purple-500 to-purple-600' :
                            getCategoryColor(setting.category) === 'amber' ? 'from-amber-500 to-amber-600' :
                            getCategoryColor(setting.category) === 'red' ? 'from-red-500 to-red-600' :
                            'from-gray-500 to-gray-600') + 
                           ' rounded-lg flex items-center justify-center text-white'">
            <i [class]="getCategoryIcon(setting.category)"></i>
          </div>

          <div class="flex-1">
            <h3 class="text-lg font-semibold text-gray-900 mb-1 font-epilogue">{{ setting.name }}</h3>
            <p class="text-sm text-gray-600 font-noto-sans">{{ setting.description }}</p>
          </div>
        </div>

        <!-- Setting Input -->
        <div class="space-y-2">
          @switch (setting.type) {

          <!-- Number Input -->
          @case ('number') {
          <div class="flex items-center gap-4">
            <input type="number" [formControlName]="setting.id" [attr.min]="setting.min" [attr.max]="setting.max"
              [attr.step]="setting.step"
              class="flex-1 px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 font-noto-sans">

            @if (setting.min !== undefined && setting.max !== undefined) {
            <div class="text-xs text-gray-500 whitespace-nowrap">
              {{ setting.min }} - {{ setting.max }}
            </div>
            }
          </div>

          <!-- Range Slider for better UX -->
          @if (setting.min !== undefined && setting.max !== undefined) {
          <input type="range" [formControlName]="setting.id" [attr.min]="setting.min" [attr.max]="setting.max"
            [attr.step]="setting.step" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
          }
          }

          <!-- Text Input -->
          @case ('text') {
          <input type="text" [formControlName]="setting.id"
            class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 font-noto-sans">
          }

          <!-- Boolean Toggle -->
          @case ('boolean') {
          <div class="flex items-center gap-3">
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" [formControlName]="setting.id" class="sr-only peer">
              <div
                class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600">
              </div>
            </label>
            <span class="text-sm font-medium text-gray-700 font-noto-sans">
              {{ configForm.get(setting.id)?.value ? 'Habilitado' : 'Deshabilitado' }}
            </span>
          </div>
          }

          <!-- Select Dropdown -->
          @case ('select') {
          <select [formControlName]="setting.id"
            class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 font-noto-sans">
            @for (option of setting.options; track option.value) {
            <option [value]="option.value">{{ option.label }}</option>
            }
          </select>
          }
          }

          <!-- Validation Error -->
          @if (configForm.get(setting.id)?.invalid && configForm.get(setting.id)?.touched) {
          <p class="text-red-600 text-sm font-noto-sans">
            @if (configForm.get(setting.id)?.errors?.['min']) {
            El valor mínimo es {{ setting.min }}
            } @else if (configForm.get(setting.id)?.errors?.['max']) {
            El valor máximo es {{ setting.max }}
            } @else {
            Valor inválido
            }
          </p>
          }
        </div>
      </div>
      }
    </div>

    <!-- Action Buttons -->
    <div class="bg-white p-6 rounded-xl shadow-sm">
      <div class="flex flex-col sm:flex-row gap-4 justify-end">

        <!-- Reset Button -->
        <button type="button" (click)="resetToDefaults()"
          class="px-6 py-3 border-2 border-gray-300 text-gray-700 font-semibold rounded-xl hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 font-noto-sans">
          <i class="fas fa-undo mr-2"></i>
          Resetear a Valores por Defecto
        </button>

        <!-- Save Button -->
        <button type="submit" [disabled]="configForm.invalid || isSaving()"
          class="px-8 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed text-white font-semibold rounded-xl shadow-md hover:shadow-lg transform hover:-translate-y-0.5 disabled:transform-none transition-all duration-200 font-noto-sans">
          @if (isSaving()) {
          <span class="flex items-center gap-2">
            <svg class="animate-spin h-5 w-5" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
              </path>
            </svg>
            Guardando...
          </span>
          } @else {
          <span class="flex items-center gap-2">
            <i class="fas fa-save"></i>
            Guardar Configuraciones
          </span>
          }
        </button>
      </div>
    </div>
  </form>

  <!-- Help Section -->
  <div class="bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-xl p-6 mt-8">
    <div class="flex items-start gap-4">
      <div
        class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white flex-shrink-0">
        <i class="fas fa-info-circle"></i>
      </div>
      <div>
        <h3 class="text-lg font-semibold text-gray-900 mb-2 font-epilogue">Información Importante</h3>
        <div class="text-sm text-gray-700 space-y-2 font-noto-sans">
          <p>• Los cambios en las configuraciones pueden tardar hasta 5 minutos en aplicarse completamente.</p>
          <p>• Se recomienda hacer cambios graduales y monitorear el impacto antes de ajustes adicionales.</p>
          <p>• Algunos algoritmos requieren reinicio del sistema para aplicar cambios críticos.</p>
          <p>• Mantén un respaldo de las configuraciones que funcionen bien antes de hacer cambios importantes.</p>
        </div>
      </div>
    </div>
  </div>
  }
</div>